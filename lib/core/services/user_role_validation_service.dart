import 'package:cloud_firestore/cloud_firestore.dart';import 'package:flutter/foundation.dart';import '../../features/auth/models/professional_account_request.dart';import '../../features/auth/models/user_model.dart';import ';      if (userCredential.user == null';        return UserValidationResult.error(';      await _createFirestoreUser(userModel';      await _updateRequestStatus(request.id, ';    } catch (e';      debugPrint('Erreur lors de la validation et creation de l\'utilisateur:  + e.toString()';      return UserValidationResult.error(';    if (request.email.isEmpty || request.fullName.isEmpty';      return ';    switch (request.role';      case 'agent_agence';      case ';        if (request.compagnieId == null || request.agenceId == null';          return 'Compagnie et agence sont obligatoires pour ce rôle';      case ';        if (request.compagnieId == null';          return 'Compagnie est obligatoire pour ce rôle';      case ';        if (request.compagnieId == null';          return 'Compagnie est obligatoire pour les experts';        return 'Rôle non reconnu: ';  static UserModel _createUserModel(ProfessionalAccountRequest request, String uid';    // Determiner le type d';      case 'agent_agence';      case 'admin_agence';      case 'admin_compagnie';      case ';    final nameParts = request.fullName.trim(').split(' ';    final prenom = nameParts.isNotEmpty ? nameParts.first : ';    final nom = nameParts.length > 1 ? nameParts.sublist(1').join(' ') : ';  static bool _shouldHaveAgence(String role';    return role == 'agent_agence' || role == ';  static Future<void> _createFirestoreUser(UserModel user';    await _firestore.collection('users).doc(user.uid).set(user.toFirestore()';    debugPrint('Utilisateur cree dans Firestore: ';  ';    await _firestore.collection('demandes_professionnels).doc(requestId';      'status';      'processedAt: Timestamp.now(';      ';    }';    debugPrint('Statut de la demande mis a jour: $requestId -> ';  ';      await _firestore.collection('demandes_professionnels).doc(requestId';        'status': 'rejetee';        'rejectionReason';        'processedAt: Timestamp.now(';        ';    } catch (e';      debugPrint('Erreur lors du rejet de la demande:  + e.toString()';      return UserValidationResult.error(';    .substring(8')}!';  ';      'fullName';      'email';      'role: _getRoleDisplayName(request.role';      'companyName';      'agencyName';      'temporaryPassword';      'loginUrl': 'https://constat-tunisie.app/login';    switch (role';      case 'agent_agence';        return 'Agent d\'agence';      case 'admin_agence';        return 'Administrateur d\'agence';      case 'admin_compagnie';        return 'Administrateur de compagnie';      case 'expert_auto';        return ';    switch (role';      case 'agent_agence';          'create_contract';          'view_contracts';          'edit_contract';          'view_claims';          'create_claim';      case 'admin_agence';          'create_contract';          'view_contracts';          'edit_contract';          'delete_contract';          'view_claims';          'create_claim';          'edit_claim';          'manage_agents';          'view_agency_stats';      case 'admin_compagnie';          'view_all_contracts';          'view_all_claims';          'manage_agencies';          'manage_admins';          'view_company_stats';          'export_data';      case 'expert_auto';          'view_assigned_claims';          'create_expertise';          'edit_expertise';          'upload_photos';          'generate_report';