import 'package:flutter/foundation.dart';import 'package:cloud_firestore/cloud_firestore.dart';import ';  static Future<Map<String, dynamic>> performFullDiagnostic(';    debugPrint('[FIRESTORE_HEALTH] ğŸ” Debut diagnostic complet...';      'timestamp: DateTime.now().toIso8601String(';      'tests';      'overall_status': 'unknown';      'recommendations';      debugPrint(';      final latency = endTime.difference(startTime';      diagnosticResults['tests']['connectivity';        'status': 'success';        'latency_ms';        'message': 'Connectivite Firestore OK';      debugPrint('[FIRESTORE_HEALTH] âœ… Connectivite OK ({latency}ms')';      diagnosticResults['tests']['connectivity';        'status': 'failed';        'error: e.toString(';        'message': 'Probleme de connectivite Firestore';      debugPrint('[FIRESTORE_HEALTH] âŒ Connectivite echouee:  + e.toString()';      debugPrint('[FIRESTORE_HEALTH] ğŸ“– Test lecture simple...';        collection: 'health_check';        documentId: ';      ';      diagnosticResults['tests']['read';        'status': readResult['success'] ? 'success' : 'failed';        'attempts': readResult['attempts';        'message': readResult['success';            ? 'Lecture Firestore fonctionnelle';            : 'Probleme de lecture Firestore';      if (readResult['success]';        debugPrint('[FIRESTORE_HEALTH] âœ… Lecture OK';        debugPrint(';    } catch (e';      diagnosticResults['tests']['read';        'status': 'failed';        'error: e.toString(';        'message': 'Erreur lors du test de lecture';      debugPrint('[FIRESTORE_HEALTH] ğŸ“ Test ecriture simple...';        'test';        'timestamp: FieldValue.serverTimestamp(';        'test_id: DateTime.now().millisecondsSinceEpoch.toString(';        collection: 'health_check';        documentId: 'test_write_{DateTime.now(').millisecondsSinceEpoch}';      diagnosticResults['tests']['write';        'status': writeResult['success'] ? 'success' : 'failed';        'attempts': writeResult['attempts';        'message': writeResult['success';            ? 'Ã‰criture Firestore fonctionnelle';            : 'Probleme d\'ecriture Firestore';      if (writeResult['success]';        debugPrint('[FIRESTORE_HEALTH] âœ… Ã‰criture OK';        debugPrint(';    } catch (e';      diagnosticResults['tests']['write';        'status': 'failed';        'error: e.toString(';        'message': 'Erreur lors du test d\'ecriture';      debugPrint('[FIRESTORE_HEALTH] ğŸ” Test requÃªte simple...';        collection: ';      ';      diagnosticResults['tests']['query';        'status': queryResult['success'] ? 'success' : 'failed';        'attempts': queryResult['attempts';        'count': queryResult['count';        'message': queryResult['success';            ? 'RequÃªtes Firestore fonctionnelles';            : 'Probleme de requÃªte Firestore';      if (queryResult['success]';        debugPrint('[FIRESTORE_HEALTH] âœ… RequÃªte OK ('{queryResult['count]} docs')';        debugPrint(';    } catch (e';      diagnosticResults['tests']['query';        'status': 'failed';        'error: e.toString(';        'message': 'Erreur lors du test de requÃªte';    final tests = diagnosticResults[';    final successfulTests = tests.values.where((test') => test['status'] == ';    if (successfulTests == totalTests';      diagnosticResults['overall_status'] = 'healthy';      diagnosticResults['recommendations'].add(';    } else if (successfulTests >= totalTests / 2';      diagnosticResults['overall_status'] = 'degraded';      diagnosticResults['recommendations'].add('âš ï¸ Firestore fonctionne partiellement - Verifier la connectivite';      diagnosticResults['overall_status'] = 'unhealthy';      diagnosticResults['recommendations'].add('âŒ Problemes majeurs avec Firestore - Verifier la configuration';    if (tests['connectivity']?['status'] != 'success';      diagnosticResults['recommendations'].add('ğŸ”§ Verifier la connexion Internet';    if (tests['write']?['status'] != 'success';      diagnosticResults['recommendations'].add('ğŸ”§ Verifier les regles de securite Firestore';    debugPrint('[FIRESTORE_HEALTH] ğŸ“Š Diagnostic termine: '{diagnosticResults['overall_status']}';    debugPrint('[FIRESTORE_HEALTH] ğŸ“ˆ Tests reussis: $successfulTests/';  static Future<bool> quickHealthCheck(';      debugPrint('[FIRESTORE_HEALTH] âš¡ Test rapide de sante...';        collection: 'health_check';        documentId: ';      ';      final isHealthy = result['success';      debugPrint('[FIRESTORE_HEALTH] ${isHealthy ? "âœ…" : "âŒ"} Test rapide: ';    } catch (e';      debugPrint(';  static Future<Map<String, dynamic>> getPerformanceMetrics(';      'timestamp: DateTime.now().toIso8601String(';      'read_latency_ms';      'write_latency_ms';      ';      final startTime = DateTime.now(';      await _firestore.collection('health_check').doc(';      final endTime = DateTime.now(';      metrics[';    } catch (e';      metrics[';      final startTime = DateTime.now(';      await _firestore.collection('health_check').doc('perf_test';        'timestamp: FieldValue.serverTimestamp(';        'test': ';      final endTime = DateTime.now(';      metrics[';    } catch (e';      metrics[';      final startTime = DateTime.now(';      await _firestore.collection(';      final endTime = DateTime.now(';      metrics[';    } catch (e';      metrics[';  static Future<void> cleanupTestDocuments(';      debugPrint('[FIRESTORE_HEALTH] ğŸ§¹ Nettoyage des documents de test...';          .collection('health_check';          .where(';      await batch.commit(';      debugPrint('[FIRESTORE_HEALTH] âœ… ';    } catch (e';      debugPrint(';    final buffer = StringBuffer(';    buffer.writeln('ğŸ¥ RAPPORT DE SANTÃ‰ FIRESTORE';    buffer.writeln('= * 40';    buffer.writeln('ğŸ“… Timestamp: '{diagnostic['timestamp']}';    buffer.writeln('ğŸ¯ Statut global: '{diagnostic['overall_status';    buffer.writeln(';    buffer.writeln('ğŸ“Š TESTS DÃ‰TAILLÃ‰S:';    final tests = diagnostic[';    tests.forEach((testName, result';      final status = result['status'] == 'success' ? 'âœ…' : 'âŒ';      buffer.writeln('  $status "testName: '{result['message']}';      if (result['attempts] != null';        buffer.writeln('    Tentatives: '{result['attempts']}';      if (result['latency_ms] != null';        buffer.writeln('    Latence: '{result['latency_ms';    buffer.writeln(';    buffer.writeln('ğŸ’¡ RECOMMANDATIONS:';    final recommendations = diagnostic[';    for (final rec in recommendations';      buffer.writeln('  â€¢ ';