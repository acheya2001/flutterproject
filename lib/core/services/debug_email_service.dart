import 'package:flutter/foundation.dart';import 'package:url_launcher/url_launcher.dart';import 'package:http/http.dart';import 'dart:convert';/// ğŸ” Service d';  static const String _tag = '[DebugEmailService]';      'timestamp';      'to';      'subject';      'htmlBodyLength';      'textBodyLength';      'steps';      'errors';      'success';      'method': 'unknown';      debugPrint('$_tag â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';      debugPrint('$_tag ğŸš€ DÃ‰BUT ENVOI EMAIL AVEC DÃ‰BUGGAGE';      debugPrint('$_tag â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';      debugPrint('$_tag ğŸ“§ Destinataire: $to';      debugPrint('$_tag ğŸ“‹ Sujet: $subject';      debugPrint('$_tag ğŸ“„ Taille HTML: ${htmlBody.length} caractÃ¨res';      debugPrint('$_tag ğŸ“„ Taille Texte: ${textBody?.length ?? 0} caractÃ¨res';      debugPrint('$_tag â° Timestamp: ${debugInfo['timestamp']}';      debugInfo['steps'].add('DÃ©but du processus d\'envoi';      // Ã‰tape 1: Validation de l';      debugPrint('$_tag ';      debugPrint('$_tag ğŸ” Ã‰TAPE 1: VALIDATION EMAIL';      debugPrint('$_tag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€';        final error = 'Format d\'email invalide: $to';        debugInfo['errors';        debugPrint('$_tag âŒ $error';      debugPrint('$_tag âœ… Email valide: $to';      debugInfo['steps'].add('Email validÃ©';      debugPrint('$_tag ';      debugPrint('$_tag ğŸ” Ã‰TAPE 2: PRÃ‰PARATION CONTENU';      debugPrint('$_tag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€';      debugPrint('$_tag ğŸ“  texte prÃ©parÃ©: ${finalTextBody.length} caractÃ¨res';      debugInfo['steps'].add(' prÃ©parÃ©';      // Ã‰tape 3: Tentative d';      debugPrint('$_tag ';      debugPrint('$_tag ğŸ” Ã‰TAPE 3: TENTATIVES D\'ENVOI';      debugPrint('$_tag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€';      if (urlResult['success';        debugInfo['method'] = 'url_launcher';        debugInfo['success';      if (webhookResult['success';        debugInfo['method'] = 'webhook';        debugInfo['success';      debugInfo['method'] = 'log_display';      debugInfo['success';      debugPrint('$_tag âŒ ERREUR GÃ‰NÃ‰RALE: $e';      debugInfo['errors'].add('Erreur gÃ©nÃ©rale: $e';      debugInfo['success';      debugPrint('$_tag ';      debugPrint('$_tag ğŸ“Š RÃ‰SUMÃ‰ FINAL';      debugPrint('$_tag â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€';      debugPrint('$_tag ğŸ¯ SuccÃ¨s: ${debugInfo['success']}';      debugPrint('$_tag ğŸ”§ MÃ©thode: ${debugInfo['method']}';      debugPrint('$_tag ğŸ“ Ã‰tapes: ${debugInfo['steps'].length}';      debugPrint('$_tag âŒ Erreurs: ${debugInfo['errors'].length}';      debugPrint('$_tag â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';  /// ğŸ”— Tentative d';    final result = <String, dynamic>{'success': false, 'error';      debugPrint('$_tag ğŸ”— Tentative URL Launcher...';      debugInfo['steps'].add('Tentative URL Launcher';      // Encoder les paramÃ¨tres pour l';      final emailUrl = 'mailto:$to?subject=$encodedSubject&body=$encodedBody';      debugPrint('$_tag ğŸ”— URL gÃ©nÃ©rÃ©e: ${emailUrl.substring(0, 100)}...';      // VÃ©rifier si l';      debugPrint('$_tag ğŸ” Peut lancer URL: $canLaunch';        debugPrint('$_tag âœ… URL Launcher rÃ©ussi';        debugInfo['steps'].add('URL Launcher rÃ©ussi';        result['success';        const error = 'Impossible de lancer l\'URL mailto';        debugPrint('$_tag âŒ $error';        debugInfo['errors';        result['error';      final error = 'Erreur URL Launcher: $e';      debugPrint('$_tag âŒ $error';      debugInfo['errors';      result['error';  /// ğŸŒ Tentative d';    final result = <String, dynamic>{'success': false, 'error';      debugPrint('$_tag ğŸŒ Tentative Webhook...';      debugInfo['steps'].add('Tentative Webhook';      const webhookUrl = 'https://httpbin.org/post';        'to';        'subject';        'html';        'text';        'timestamp';        'source': 'constat_tunisie_app';      debugPrint('$_tag ğŸ“¤ Envoi vers: $webhookUrl';      debugPrint('$_tag ğŸ“¦ Payload: ${payload.keys.join(', ')}';          'Content-Type': 'application/json';          'User-Agent': 'ConstatTunisie/1.0';      debugPrint('$_tag ğŸ“¨ RÃ©ponse HTTP: ${response.statusCode}';      debugPrint('$_tag ğŸ“„ Corps rÃ©ponse: ${response.body.substring(0, 200)}...';        debugPrint('$_tag âœ… Webhook rÃ©ussi';        debugInfo['steps'].add('Webhook rÃ©ussi';        result['success';        final error = 'Webhook Ã©chec: ${response.statusCode}';        debugPrint('$_tag âŒ $error';        debugInfo['errors';        result['error';      final error = 'Erreur Webhook: $e';      debugPrint('$_tag âŒ $error';      debugInfo['errors';      result['error';    debugPrint('$_tag ğŸ“‹ Affichage dans les logs (fallback)...';    debugInfo['steps'].add('Affichage logs';    debugPrint('$_tag ';    debugPrint('$_tag â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—';    debugPrint('$_tag â•‘                    ğŸ“§ EMAIL GÃ‰NÃ‰RÃ‰                       â•‘';    debugPrint('$_tag â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£';    debugPrint('$_tag â•‘ ğŸ“§ DESTINATAIRE: $to';    debugPrint('$_tag â•‘ ğŸ“‹ SUJET: $subject';    debugPrint('$_tag â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£';    debugPrint('$_tag â•‘ ğŸ“„ CONTENU TEXTE:';    final lines = textBody.split('\n';      debugPrint('$_tag â•‘ ${lines[i]}';      debugPrint('$_tag â•‘ ... (${lines.length - 20} lignes supplÃ©mentaires)';    debugPrint('$_tag â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£';    debugPrint('$_tag â•‘ ğŸŒ CONTENU HTML: ${htmlBody.length} caractÃ¨res';    debugPrint('$_tag â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';    debugPrint('$_tag ';  /// ğŸ” Validation de l';    final emailRegex = RegExp(r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$';        .replaceAll(RegExp(r'<br\s*/?>', caseSensitive: false), '\n';        .replaceAll(RegExp(r'<p[^>]*>', caseSensitive: false), '\n';        .replaceAll(RegExp(r'</p>', caseSensitive: false), '\n';        .replaceAll(RegExp(r'<div[^>]*>', caseSensitive: false), '\n';        .replaceAll(RegExp(r'</div>', caseSensitive: false), '\n';        .replaceAll(RegExp(r'<[^>]*>'), '';        .replaceAll('&nbsp;', ' ';        .replaceAll('&amp;', '&';        .replaceAll('&lt;', '<';        .replaceAll('&gt;', '>';        .replaceAll('&quot;', '"';        .replaceAll(RegExp(r'\n\s*\n'), '\n\n';  /// ğŸ“Š Obtenir les statistiques d';      'service': 'DebugEmailService';      'version': '1.0.0';      'methods': ['url_launcher', 'webhook', 'log_display';      'timestamp';      'timestamp';      'tests';    debugPrint('$_tag ğŸ§ª TEST DE CONNECTIVITÃ‰ EMAIL';    debugPrint('$_tag â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';      final testUri = Uri.parse('mailto:test@example.com';      results['tests']['url_launcher';        'available';        'error';      debugPrint('$_tag âœ… URL Launcher: $canLaunch';      results['tests']['url_launcher';        'available';        'error';      debugPrint('$_tag âŒ URL Launcher: $e';        Uri.parse('https://httpbin.org/status/200';      results['tests']['http';        'available';        'status_code';        'error';      debugPrint('$_tag âœ… HTTP: ${response.statusCode}';      results['tests']['http';        'available';        'error';      debugPrint('$_tag âŒ HTTP: $e';    debugPrint('$_tag â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•';