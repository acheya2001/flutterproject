import 'package:flutter/material.dart';import 'package:flutter_riverpod/flutter_riverpod.dart';import 'package:image_picker/image_picker.dart';import 'package:cloud_firestore/cloud_firestore.dart';import 'dart:io';import '../services/universal_auth_service.dart';import 'agent_login_screen.dart';/// üìù √âcran d';  // üîí Variables d';    'Agent Commercial';    'Conseiller Client√®le';    'Charg√© de Sinistres';    'Inspecteur Commercial';    'Responsable Agence';    'Chef d\'√âquipe';    'Agent de Production';    'Gestionnaire de Contrats';    'Tunis', 'Ariana', 'Ben Arous', 'Manouba', 'Nabeul', 'Zaghouan';    'Bizerte', 'B√©ja', 'Jendouba', 'Le Kef', 'Siliana', 'Kairouan';    'Kasserine', 'Sidi Bouzid', 'Sousse', 'Monastir', 'Mahdia', 'Sfax';    'Gafsa', 'Tozeur', 'Kebili', 'Gab√®s', 'Medenine', 'Tataouine';          .collection('compagnies_assurance';          .where('active';          data['id';      debugPrint('‚ùå Erreur chargement compagnies: $e';            case 'cinRecto';            case 'cinVerso';            case 'justificatifTravail';      _showErrorSnackBar('Erreur lors de la s√©lection de l\'image: $e';              title: const Text('Prendre une photo';              title: const Text('Choisir depuis la galerie';  /// ‚ö†Ô∏è Afficher message d';  /// üìù Soumettre la demande d';      // Cr√©er la demande d';          .collection('professional_account_requests';      debugPrint('‚úÖ Demande cr√©√©e: ${docRef.id}';      debugPrint('‚ùå Erreur inscription: $e';      _showErrorSnackBar('Erreur lors de l\'inscription: $e';      _showErrorSnackBar('Veuillez remplir tous les champs obligatoires';  /// üìã Construire les donn√©es d';      'email';      'nom';      'prenom';      'telephone';      'compagnieId': _selectedCompagnie!['id';      'compagnieNom': _selectedCompagnie!['nom';      'agenceNom';      'agenceAdresse';      'agenceVille';      'agenceGouvernorat';      'agenceTelephone';      'poste';      'numeroAgent';      'status': 'pending';      'submittedAt';      'password';        title: const Text('üìã Demande Envoy√©e !';              'Demande d\'inscription cr√©√©e\n${_prenomController.text} ${_nomController.text}';              '${_selectedCompagnie?['nom'] ?? ''} - ${_agenceNomController.text}';              'Votre demande est en attente d\'approbation.\n';              'Vous recevrez un email de confirmation.';            child: const Text('Aller √† la Connexion';        title: const Text('Inscription Agent';            'üë§ Informations Personnelles';              labelText: 'Pr√©nom *';            validator: (value) => value?.trim().isEmpty == true ? 'Pr√©nom requis';              labelText: 'Nom *';            validator: (value) => value?.trim().isEmpty == true ? 'Nom requis';              labelText: 'Email professionnel *';              if (value?.trim().isEmpty == true) return 'Email requis';              if (!RegExp(r'^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$';                return 'Email invalide';              labelText: 'T√©l√©phone *';            validator: (value) => value?.trim().isEmpty == true ? 'T√©l√©phone requis';              labelText: 'Mot de passe *';              if (value?.trim().isEmpty == true) return 'Mot de passe requis';              if (value!.length < 6) return 'Au moins 6 caract√®res';              labelText: 'Confirmer le mot de passe *';                return 'Les mots de passe ne correspondent pas';            'üè¢ Informations Professionnelles';          // Compagnie d';                    labelText: 'Compagnie d\'assurance *';                      child: Text(compagnie['nom'] ?? 'Nom non disponible';                  validator: (value) => value == null ? 'Compagnie requise';          // Nom de l';              labelText: 'Nom de l\'agence *';            validator: (value) => value?.trim().isEmpty == true ? 'Nom d\'agence requis';              labelText: 'Gouvernorat *';            validator: (value) => value == null ? 'Gouvernorat requis';              labelText: 'Poste *';            validator: (value) => value == null ? 'Poste requis';          // Num√©ro d';              labelText: 'Num√©ro d\'agent (optionnel)';            'üÜî Documents d\'Identit√©';            'CIN obligatoire ‚Ä¢ Justificatif de travail recommand√©';            'CIN (Recto) *';            () => _pickImage('cinRecto';            'CIN (Verso) *';            () => _pickImage('cinVerso';            'Justificatif de Travail (Optionnel)';            () => _pickImage('justificatifTravail';  /// üì∏ Widget de s√©lection d';                      label: const Text('Modifier';                const Text('Appuyez pour ajouter';                child: const Text('Pr√©c√©dent';                  : Text(_currentPage < 2 ? 'Suivant' : 'Soumettre';