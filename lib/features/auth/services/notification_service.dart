import 'package:cloud_firestore/cloud_firestore.dart';import 'package:flutter/foundation.dart';import '../models/notification_model.dart';import '../models/user_model.dart';import 'email_service.dart';import '../../../core/services/firebase_email_service.dart';  static const String _collection = 'notifications';        id: '';      debugPrint('âœ… Notification crÃ©Ã©e pour $recipientId: $title';      debugPrint('âŒ Erreur crÃ©ation notification: $e';  /// Obtenir les notifications d';        .where('recipientId';        .orderBy('createdAt';        'isRead';        'readAt';      debugPrint('âŒ Erreur marquage notification: $e';          .where('recipientId';          .where('isRead';          'isRead';          'readAt';      debugPrint('âŒ Erreur marquage toutes notifications: $e';        .where('recipientId';        .where('isRead';      debugPrint('âŒ Erreur suppression notification: $e';  /// Notifier l'admin d';        .collection('users';        .where('userType', isEqualTo: 'admin';      final adminEmail = adminData['email';        title: 'ğŸ†• Nouvelle demande de compte';        message: '$applicantName ($userType) a demandÃ© la crÃ©ation d\'un compte professionnel.';          'requestId';          'applicantEmail';          'userType';          'action': 'review_account_request';  /// Notifier l'utilisateur de l';    print('ğŸ” DEBUG: notifyAccountApproved - userId: $userId, approvedBy: $approvedBy';      title: 'âœ… Compte approuvÃ©';      message: 'FÃ©licitations ! Votre compte professionnel a Ã©tÃ© approuvÃ©. Vous pouvez maintenant vous connecter.';        'action': 'account_approved';        'approvedBy';    // Envoyer l';      print('ğŸ” DEBUG: Recherche utilisateur dans collection users...';      final userDoc = await _firestore.collection('users';        print('âœ… DEBUG: Utilisateur trouvÃ© dans users';        final userEmail = userData['email';        final userName = '${userData['prenom']} ${userData['nom']}';        final userType = userData['userType';        print('ğŸ” DEBUG: Email: $userEmail, Nom: $userName, Type: $userType';          print('ğŸ” DEBUG: Envoi email d\'approbation...';          print(emailSent ? 'âœ… DEBUG: Email envoyÃ© avec succÃ¨s' : 'âŒ DEBUG: Ã‰chec envoi email';          print('âŒ DEBUG: Email ou type utilisateur manquant';        print('âŒ DEBUG: Utilisateur non trouvÃ© dans collection users';        // L'utilisateur n';      print('âŒ DEBUG: Erreur envoi email approbation: $e';      debugPrint('âŒ Erreur envoi email approbation: $e';      print('ğŸ” DEBUG: RÃ©cupÃ©ration donnÃ©es depuis professional_account_requests...';      final requestDoc = await _firestore.collection('professional_account_requests';        final userEmail = requestData['email';        final userName = '${requestData['prenom']} ${requestData['nom']}';        final userType = requestData['userType';        print('ğŸ” DEBUG: DonnÃ©es demande - Email: $userEmail, Nom: $userName, Type: $userType';          print('ğŸ” DEBUG: ğŸ”¥ Envoi email d\'approbation via FirebaseEmailService (mÃªme mÃ©thode que les invitations)...';          print(emailSent ? 'âœ… DEBUG: Email d\'approbation envoyÃ© via Firebase' : 'âŒ DEBUG: Ã‰chec envoi email Firebase';        print('âŒ DEBUG: Demande non trouvÃ©e';      print('âŒ DEBUG: Erreur rÃ©cupÃ©ration donnÃ©es demande: $e';  /// ğŸ“§ Envoyer email d';      print('ğŸ“§ DEBUG: Envoi email d\'approbation via mÃ©thode dÃ©diÃ©e...';      print(success ? 'âœ… DEBUG: Email d\'approbation envoyÃ©' : 'âŒ DEBUG: Ã‰chec envoi email';      print('âŒ DEBUG: Erreur envoi email: $e';  /// Notifier l';    print('ğŸ” DEBUG: notifyAccountRejected - userId: $userId, reason: $reason';      title: 'âŒ Compte rejetÃ©';      message: 'Votre demande de compte professionnel a Ã©tÃ© rejetÃ©e. Raison: $reason';        'action': 'account_rejected';        'rejectedBy';        'reason';    // Envoyer l';      print('ğŸ” DEBUG: Recherche utilisateur pour email de rejet...';      final userDoc = await _firestore.collection('users';        print('âœ… DEBUG: Utilisateur trouvÃ© dans users';        final userEmail = userData['email';        final userName = '${userData['prenom']} ${userData['nom']}';        final userType = userData['userType';          print('ğŸ” DEBUG: Envoi email de rejet...';          print(emailSent ? 'âœ… DEBUG: Email de rejet envoyÃ©' : 'âŒ DEBUG: Ã‰chec envoi email rejet';        print('âŒ DEBUG: Utilisateur non trouvÃ©, envoi depuis demande...';      print('âŒ DEBUG: Erreur envoi email rejet: $e';      debugPrint('âŒ Erreur envoi email rejet: $e';      print('ğŸ“§ DEBUG: Envoi email de rejet via mÃ©thode dÃ©diÃ©e...';      print('âŒ DEBUG: Erreur envoi email rejet: $e';      print('ğŸ” DEBUG: RÃ©cupÃ©ration donnÃ©es demande pour email de rejet...';      final requestDoc = await _firestore.collection('professional_account_requests';        final userEmail = requestData['email';        final userName = '${requestData['prenom']} ${requestData['nom']}';        final userType = requestData['userType';          print('ğŸ” DEBUG: Envoi email de rejet depuis donnÃ©es demande...';          print(emailSent ? 'âœ… DEBUG: Email de rejet envoyÃ© depuis demande' : 'âŒ DEBUG: Ã‰chec envoi email rejet depuis demande';      print('âŒ DEBUG: Erreur rÃ©cupÃ©ration donnÃ©es demande pour rejet: $e';  /// Notifier l';      title: 'âš ï¸ Compte suspendu';      message: 'Votre compte a Ã©tÃ© temporairement suspendu. Raison: $reason';        'action': 'account_suspended';        'suspendedBy';        'reason';  /// Notifier l';      title: 'ğŸ”§ Permissions modifiÃ©es';      message: 'Vos permissions ont Ã©tÃ© mises Ã  jour par un administrateur.';        'action': 'permissions_changed';        'changedBy';        'newPermissions';  static const String _collection = 'professional_account_requests';      print('ğŸ” DEBUG: VÃ©rification unicitÃ© email: $email';          .collection('users';          .where('email';        print('âŒ DEBUG: Email trouvÃ© dans users';          .where('email';          .where('status', whereIn: ['pending', 'approved';        print('âŒ DEBUG: Email trouvÃ© dans demandes en attente/approuvÃ©es';      print('âœ… DEBUG: Email disponible';      print('âŒ DEBUG: Erreur vÃ©rification email: $e';      return false; // En cas d';      print('ğŸ” DEBUG: ProfessionalAccountService.createAccountRequest() - DÃ©but';      print('ğŸ” DEBUG: Collection: $_collection';      print('ğŸ” DEBUG: Request email: ${request.email}';      print('ğŸ” DEBUG: Request userType: ${request.userType}';      // VÃ©rifier l'unicitÃ© de l';      print('ğŸ” DEBUG: VÃ©rification unicitÃ© email...';        throw Exception('Un compte avec cet email existe dÃ©jÃ  ou une demande est en cours de traitement';      print('âœ… DEBUG: Email unique confirmÃ©';      print('ğŸ” DEBUG: Conversion vers Firestore...';      print('ğŸ” DEBUG: DonnÃ©es Firestore crÃ©Ã©es: ${firestoreData.keys.toList()}';      print('ğŸ” DEBUG: Ajout Ã  Firestore...';      print('âœ… DEBUG: Document crÃ©Ã© avec ID: ${docRef.id}';      print('ğŸ” DEBUG: Notification des admins...';        applicantName: '${request.prenom} ${request.nom}';      print('âœ… DEBUG: Admins notifiÃ©s';      debugPrint('âœ… Demande de compte crÃ©Ã©e: ${docRef.id}';      print('âŒ DEBUG: Erreur dans createAccountRequest: $e';      print('âŒ DEBUG: Type d\'erreur: ${e.runtimeType}';      debugPrint('âŒ Erreur crÃ©ation demande: $e';        .where('status', isEqualTo: 'pending';        .orderBy('createdAt';      debugPrint('âŒ Erreur rÃ©cupÃ©ration demande: $e';        'status': 'approved';        'reviewedAt';        'reviewedBy';      // Obtenir la demande pour notifier l';      debugPrint('âŒ Erreur approbation demande: $e';        'status': 'rejected';        'rejectionReason';        'reviewedAt';        'reviewedBy';      // Obtenir la demande pour notifier l';      debugPrint('âŒ Erreur rejet demande: $e';