import 'package:cloud_firestore/cloud_firestore.dart';import 'package:flutter/material.dart';import '../../../admin/models/professional_request_model_final.dart';import '../../../../core/services/email_notification_service.dart';  static const String _collection = 'demandes_professionnels';      debugPrint('[REQUEST_SUBMISSION] üì§ Soumission demande: ${request.nomComplet}';      // V√©rifier si l';        throw Exception('Une demande avec cet email existe d√©j√†';      requestData['created_at';      requestData['updated_at';      requestData['ip_address';      requestData['user_agent'] = 'Flutter Mobile App';      debugPrint('[REQUEST_SUBMISSION] ‚úÖ Demande soumise avec ID: ${docRef.id}';        debugPrint('[ProfessionalRequest] ‚úÖ Email de notification envoy√© aux admins';        debugPrint('[ProfessionalRequest] ‚ö†Ô∏è Erreur envoi email: $e';        // Ne pas bloquer la soumission si l';      debugPrint('[REQUEST_SUBMISSION] ‚ùå Erreur soumission: $e';          .where('email';      debugPrint('[REQUEST_SUBMISSION] ‚ùå Erreur v√©rification email: $e';  /// üåê Obtenir l';    // En production, vous pourriez utiliser un service pour obtenir l';    return 'Unknown';  /// üîî Notifier les admins d';      await _firestore.collection('admin_notifications';        'type': 'new_professional_request';        'title': 'Nouvelle demande de compte professionnel';        'message': '${request.nomComplet} a soumis une demande de compte ${request.roleFormate}';        'request_id';        'request_email';        'request_role';        'created_at';        'is_read';        'priority': 'normal';      debugPrint('[REQUEST_SUBMISSION] üîî Notification admin cr√©√©e';      debugPrint('[REQUEST_SUBMISSION] ‚ùå Erreur notification admin: $e';        // Demandes aujourd';            .where('envoye_le';            .where('envoye_le';            .where('envoye_le';        'today';        'this_week';        'this_month';        'total';        'by_status';        'by_role';      debugPrint('[REQUEST_SUBMISSION] ‚ùå Erreur statistiques: $e';        'today';        'this_week';        'this_month';        'total';        'by_status';        'by_role';      'en_attente';      'acceptee';      'rejetee';      final status = data['status'] ?? 'en_attente';      'agent_agence';      'expert_auto';      'admin_compagnie';      'admin_agence';      final role = data['role_demande'] ?? '';      return 'Le nom complet est obligatoire';      return 'Email invalide';      return 'Le num√©ro de t√©l√©phone est obligatoire';      return 'Le CIN est obligatoire';      case 'agent_agence';          return 'Le nom de l\'agence est obligatoire pour un agent';          return 'La compagnie d\'assurance est obligatoire pour un agent';          return 'L\'adresse de l\'agence est obligatoire pour un agent';      case 'expert_auto';          return 'Le num√©ro d\'agr√©ment est obligatoire pour un expert';          return 'La compagnie d\'assurance est obligatoire pour un expert';          return 'La zone d\'intervention est obligatoire pour un expert';      case 'admin_compagnie';          return 'Le nom de la compagnie est obligatoire pour un admin compagnie';          return 'La fonction est obligatoire pour un admin compagnie';          return 'L\'adresse du si√®ge est obligatoire pour un admin compagnie';      case 'admin_agence';          return 'Le nom de l\'agence est obligatoire pour un admin agence';          return 'La compagnie d\'assurance est obligatoire pour un admin agence';          return 'La ville est obligatoire pour un admin agence';          return 'L\'adresse de l\'agence est obligatoire pour un admin agence';        return 'R√¥le invalide';  /// ‚úÖ Valider l';    return RegExp(r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$';      updates['updated_at';      debugPrint('[REQUEST_SUBMISSION] ‚úÖ Demande mise √† jour: $requestId';      debugPrint('[REQUEST_SUBMISSION] ‚ùå Erreur mise √† jour: $e';      debugPrint('[REQUEST_SUBMISSION] ‚úÖ Demande supprim√©e: $requestId';      debugPrint('[REQUEST_SUBMISSION] ‚ùå Erreur suppression: $e';      debugPrint('[REQUEST_SUBMISSION] ‚ùå Erreur r√©cup√©ration: $e';