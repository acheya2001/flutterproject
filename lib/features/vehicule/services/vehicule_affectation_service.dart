import 'package:cloud_firestore/cloud_firestore.dart';import 'package:flutter/foundation.dart';import '../models/vehicule_conducteur_liaison_model.dart';import '../models/vehicule_assure_model.dart';import '../../auth/models/user_model.dart';/// 🔗 Service d';      debugPrint('🔗 Affectation véhicule: $vehiculeId → $conducteurEmail';          .collection('vehicules_assures';        throw Exception('Véhicule non trouvé: $vehiculeId';      // Vérifier s';          .collection('vehicules_conducteurs_liaisons';          .where('vehicule_id';          .where('statut', isEqualTo: 'actif';          'statut': 'annule';          'updatedAt';      final liaisonId = _firestore.collection('vehicules_conducteurs_liaisons';        _firestore.collection('vehicules_conducteurs_liaisons';      debugPrint('✅ Véhicule affecté avec succès';      debugPrint('❌ Erreur affectation véhicule: $e';  /// 📧 Envoyer notification d';      // TODO: Implémenter l'envoi d';      debugPrint('📧 Notification envoyée à: ${liaison.conducteurEmail}';          .collection('vehicules_conducteurs_liaisons';        'notification_envoyee';        'date_notification';      debugPrint('❌ Erreur envoi notification: $e';  /// 📋 Obtenir les véhicules d';      debugPrint('📋 Récupération véhicules pour: $conducteurEmail';          .collection('vehicules_conducteurs_liaisons';          .where('conducteur_email';          .where('statut', isEqualTo: 'actif';        debugPrint('ℹ️ Aucun véhicule affecté à ce conducteur';            .collection('vehicules_assures';      debugPrint('✅ ${vehicules.length} véhicules trouvés';      debugPrint('❌ Erreur récupération véhicules conducteur: $e';  /// 🔍 Obtenir les liaisons d';          .collection('vehicules_conducteurs_liaisons';          .where('agent_affecteur';          .orderBy('createdAt';      debugPrint('❌ Erreur récupération liaisons agent: $e';  /// 🔄 Modifier le statut d';          .collection('vehicules_conducteurs_liaisons';        'statut';        'updatedAt';      debugPrint('✅ Statut liaison modifié: $liaisonId → ${nouveauStatut.name}';      debugPrint('❌ Erreur modification statut liaison: $e';  /// 🔑 Modifier les droits d';          .collection('vehicules_conducteurs_liaisons';        'droits';        'updatedAt';      debugPrint('✅ Droits liaison modifiés: $liaisonId';      debugPrint('❌ Erreur modification droits liaison: $e';  /// 📊 Obtenir les statistiques d';          .collection('vehicules_conducteurs_liaisons';          .where('agent_affecteur';        'total_affectations';        'affectations_actives';        'affectations_expirees';        'affectations_suspendues';        'taux_activite';      debugPrint('❌ Erreur statistiques affectation: $e';          .collection('vehicules_conducteurs_liaisons';          .where('conducteur_email';          .where('vehicule_id';          .where('statut', isEqualTo: 'actif';      // Vérifier l';      debugPrint('❌ Erreur vérification droit véhicule: $e';      debugPrint('🔄 Synchronisation des liaisons...';          .collection('vehicules_conducteurs_liaisons';          .where('conducteur_id';            .collection('users';            .where('email';            .where('type', isEqualTo: 'conducteur';            'conducteur_id';            'updatedAt';        debugPrint('✅ $synchronized liaisons synchronisées';        debugPrint('ℹ️ Aucune liaison à synchroniser';      debugPrint('❌ Erreur synchronisation liaisons: $e';