import 'package:flutter/foundation.dart';import '../../../core/services/firestore_session_service.dart';import '../../../core/services/firebase_email_service.dart';import '../../../core/exceptions/app_exceptions.dart';import '../models/session_constat_model.dart';import '../models/conducteur_session_info.dart';import '../../conducteur/models/conducteur_info_model.dart';import '../../conducteur/models/vehicule_accident_model.dart';import '../../conducteur/models/assurance_info_model.dart';import '../models/proprietaire_info.dart';import '../models/temoin_model.dart';/// G√®re l';/// gestion d';  /// üîÑ Met √† jour l';  /// ‚ùå Met √† jour l';      debugPrint('[CollaborativeSession] === CR√âATION SESSION ===';        throw const DataValidationException('Le nombre de conducteurs doit √™tre entre 2 et 6';        throw const DataValidationException('Nombre d\'emails incorrect';      conducteursInfo['A';        position: 'A';      final positions = ['B', 'C', 'D', 'E', 'F';        id: '';        lieuAccident: lieuAccident ?? '';      _setSuccess('Session cr√©√©e avec succ√®s ! Invitations envoy√©es.';      debugPrint('[CollaborativeSession] ‚úÖ Session cr√©√©e: $sessionId';      debugPrint('[CollaborativeSession] ‚ùå Erreur m√©tier: ${e.message}';      debugPrint('[CollaborativeSession] ‚ùå Erreur inattendue: $e';      debugPrint('[CollaborativeSession] === REJOINDRE SESSION ===';        throw const InvalidSessionCodeException('Code vide';      _setSuccess('Connect√© √† la session avec succ√®s !';      debugPrint('[CollaborativeSession] ‚úÖ Session rejointe';      debugPrint('[CollaborativeSession] ‚ùå Erreur m√©tier: ${e.message}';      debugPrint('[CollaborativeSession] ‚ùå Erreur inattendue: $e';  /// üíæ Sauvegarde les donn√©es d';      debugPrint('[CollaborativeSession] === SAUVEGARDE DONN√âES ===';        _setSuccess('Constat termin√© ! Tous les conducteurs ont valid√© leurs informations.';        _setSuccess('Donn√©es sauvegard√©es avec succ√®s !';      debugPrint('[CollaborativeSession] ‚úÖ Donn√©es sauvegard√©es';      debugPrint('[CollaborativeSession] ‚ùå Erreur m√©tier: ${e.message}';      debugPrint('[CollaborativeSession] ‚ùå Erreur inattendue: $e';            customMessage: 'Un conducteur vous invite √† rejoindre une session de constat collaboratif.';          debugPrint('[CollaborativeSession] ‚úÖ Invitation envoy√©e √†: $email';          debugPrint('[CollaborativeSession] ‚ùå Erreur envoi email $email: $e';    final random = (timestamp % 10000).toString().padLeft(4, '0';    return 'SESS_$random';  /// ‚úÖ Valide le format d';    return RegExp(r'^[^@]+@[^@]+\.[^@]+$';    if (_currentSession == null) return 'Aucune session';    return '$validatedCount/$totalCount conducteurs ont termin√©';  /// üéØ Trouve la position d';