import 'package:cloud_firestore/cloud_firestore.dart';import 'package:flutter/foundation.dart';import '../models/vehicule_complet_model.dart';/// ğŸ“‹ Service de gestion des contrats d';  /// âœ… CrÃ©er un nouveau contrat d';      debugPrint('ğŸ“‹ CrÃ©ation nouveau contrat: ${vehicule.contrat.numeroContrat}';      // 1. VÃ©rifier que le numÃ©ro de contrat n';          .collection('vehicules_complets';          .where('contrat.numero_contrat';        throw Exception('Un contrat avec ce numÃ©ro existe dÃ©jÃ ';      // 2. VÃ©rifier que l'immatriculation n';          .collection('vehicules_complets';          .where('immatriculation';        throw Exception('Un vÃ©hicule avec cette immatriculation existe dÃ©jÃ ';      final vehiculeRef = _firestore.collection('vehicules_complets';      // 4. Enregistrer l';        action: 'creation';          'vehicule': '${vehicule.marque} ${vehicule.modele}';          'immatriculation';          'proprietaire';          'type_couverture';          'prime_annuelle';      // 5. Mettre Ã  jour les statistiques de l';      debugPrint('âœ… Contrat crÃ©Ã© avec succÃ¨s: ${vehiculeRef.id}';      debugPrint('âŒ Erreur crÃ©ation contrat: $e';  /// ğŸ“Š Obtenir les contrats d';          .collection('vehicules_complets';          .where('contrat.agent_gestionnaire';          .orderBy('createdAt';      debugPrint('âŒ Erreur rÃ©cupÃ©ration contrats agent: $e';  /// ğŸ“Š Obtenir les contrats d';          .collection('vehicules_complets';          .where('contrat.agence_id';          .orderBy('createdAt';      debugPrint('âŒ Erreur rÃ©cupÃ©ration contrats agence: $e';  /// ğŸ“Š Obtenir les contrats d';          .collection('vehicules_complets';          .where('contrat.compagnie_id';          .orderBy('createdAt';      debugPrint('âŒ Erreur rÃ©cupÃ©ration contrats compagnie: $e';          .collection('vehicules_complets';          .where('contrat.numero_contrat';      debugPrint('âŒ Erreur recherche contrat: $e';      await _firestore.collection('vehicules_complets';        'contrat.date_fin';        'contrat.statut': 'actif';        'updatedAt';      debugPrint('âœ… Contrat renouvelÃ©: $vehiculeId';      debugPrint('âŒ Erreur renouvellement contrat: $e';      await _firestore.collection('vehicules_complets';        'contrat.statut': 'suspendu';        'contrat.raison_suspension';        'updatedAt';      debugPrint('âœ… Contrat suspendu: $vehiculeId';      debugPrint('âŒ Erreur suspension contrat: $e';      Query query = _firestore.collection('vehicules_complets';        query = query.where('contrat.agent_gestionnaire';        query = query.where('contrat.agence_id';        query = query.where('contrat.compagnie_id';        query = query.where('createdAt';        query = query.where('createdAt';        final contratData = data['contrat';        final statut = contratData['statut';          case 'actif';          case 'suspendu';          case 'expire';        primeTotal += (contratData['prime_annuelle';        final typeCouverture = contratData['type_couverture';        final marque = data['marque';        'total_contrats';        'contrats_actifs';        'contrats_suspendus';        'contrats_expires';        'prime_totale';        'prime_moyenne';        'contrats_par_type';        'contrats_par_marque';        'taux_activite';      debugPrint('âŒ Erreur statistiques contrats: $e';      final activityId = _firestore.collection('contrats_activites';      await _firestore.collection('contrats_activites';        'id';        'contract_id';        'contract_number';        'action';        'agent_id';        'details';        'timestamp';        'createdAt';      debugPrint('ğŸ“ ActivitÃ© contrat enregistrÃ©e: $action';      debugPrint('âŒ Erreur enregistrement activitÃ©: $e';      // Ne pas faire Ã©chouer l';  /// ğŸ“Š Mettre Ã  jour les statistiques d';      final agenceRef = _firestore.collection('agences';          final currentContracts = currentStats['contrats_actifs';          final currentVehicules = currentStats['vehicules_geres';            'contrats_actifs';            'vehicules_geres';            'updatedAt';      debugPrint('ğŸ“Š Statistiques agence mises Ã  jour: $agenceId';      debugPrint('âŒ Erreur mise Ã  jour stats agence: $e';      // Ne pas faire Ã©chouer l';