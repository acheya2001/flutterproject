import 'package:cloud_firestore/cloud_firestore.dart';import 'package:firebase_messaging/firebase_messaging.dart';import 'package:flutter_local_notifications/flutter_local_notifications.dart';import 'dart:convert';import 'package:http/http.dart';/// üîî Service de gestion des notifications pour les contrats d';      print('üîî [NOTIFICATION] Envoi notification contrat: $numeroContrat';      // 1. Trouver l';          .collection('users';          .where('email';        print('‚ùå [NOTIFICATION] Utilisateur non trouv√©: $conducteurEmail';      final fcmToken = userData.data()['fcmToken';      await _firestore.collection('notifications';        'userId';        'type': 'nouveau_contrat';        'title': 'üöó Nouveau contrat d\'assurance';        'message': 'Votre v√©hicule $vehiculeImmatriculation a √©t√© assur√© chez $compagnieNom';        'data';          'numeroContrat';          'vehiculeImmatriculation';          'compagnieNom';          'agentNom';          'action': 'view_contract';        'isRead';        'createdAt';          title: 'üöó Nouveau contrat d\'assurance';          body: 'Votre v√©hicule $vehiculeImmatriculation a √©t√© assur√© chez $compagnieNom';            'type': 'nouveau_contrat';            'numeroContrat';            'vehiculeImmatriculation';      print('‚úÖ [NOTIFICATION] Notification envoy√©e avec succ√®s';      print('‚ùå [NOTIFICATION] Erreur envoi notification: $e';      const String serverKey = 'YOUR_FCM_SERVER_KEY';        Uri.parse('https://fcm.googleapis.com/fcm/send';          'Content-Type': 'application/json';          'Authorization': 'key=$serverKey';          'to';          'notification';            'title';            'body';            'sound': 'default';          'data';          'priority': 'high';        print('‚úÖ [FCM] Push notification envoy√©e';        print('‚ùå [FCM] Erreur envoi push: ${response.statusCode}';      print('‚ùå [FCM] Erreur push notification: $e';      final emailBody = ''';          <title>Nouveau Contrat d';              <h1 style="color: white; margin: 0;">üöó Nouveau Contrat d';                  <p><strong>Date :</strong> ${DateTime.now().toString().split(' ';                  En cas d'accident, utilisez l';      ''';      // Ici vous pouvez int√©grer votre service d';      print('üìß [EMAIL] Email pr√©par√© pour: $recipientEmail';      print('‚ùå [EMAIL] Erreur envoi email: $e';        AndroidInitializationSettings('@mipmap/ic_launcher';      'contract_channel';      'Contrats d\'assurance';      channelDescription: 'Notifications pour les contrats d\'assurance';  /// üìã R√©cup√©rer les notifications d';        .collection('notifications';        .where('userId';        .orderBy('createdAt';            .map((doc) => {'id';        .collection('notifications';        .update({'isRead';