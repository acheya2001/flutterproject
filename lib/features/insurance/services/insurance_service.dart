import 'package:cloud_firestore/cloud_firestore.dart';import 'package:flutter/foundation.dart';import '../models/insurance_contract.dart';/// 🏢 Service de gestion des contrats d';  static const String _contractsCollection = 'insurance_contracts';  static const String _vehiclesCollection = 'vehicles';  /// 📋 Créer un nouveau contrat d';      debugPrint('🔍 [InsuranceService] Création contrat: ${contract.numeroContrat}';      // Vérifier l';          .where('numeroContrat';          .where('compagnieAssurance';        throw Exception('Un contrat avec ce numéro existe déjà pour cette compagnie';      // Créer d';      // Créer le contrat avec l';      debugPrint('✅ [InsuranceService] Contrat créé: ${contractRef.id}';      debugPrint('❌ [InsuranceService] Erreur création contrat: $e';  /// 📥 Récupérer les contrats d';      debugPrint('🔍 [InsuranceService] Récupération contrats agent: $agentId';          .where('agentId';          .orderBy('createdAt';      debugPrint('✅ [InsuranceService] ${contracts.length} contrats trouvés';      debugPrint('❌ [InsuranceService] Erreur récupération contrats: $e';      debugPrint('🔍 [InsuranceService] Recherche contrat: $numeroContrat ($compagnie)';          .where('numeroContrat';          .where('compagnieAssurance';        debugPrint('❌ [InsuranceService] Contrat non trouvé';      debugPrint('✅ [InsuranceService] Contrat trouvé: ${contract.id}';      debugPrint('❌ [InsuranceService] Erreur recherche contrat: $e';      debugPrint('🔍 [InsuranceService] Recherche véhicule: $immatriculation';          .where('vehicule.numeroImmatriculation';      debugPrint('✅ [InsuranceService] ${contracts.length} contrats trouvés pour le véhicule';      debugPrint('❌ [InsuranceService] Erreur recherche véhicule: $e';      debugPrint('🔍 [InsuranceService] Mise à jour contrat: $contractId';      updates['updatedAt';      debugPrint('✅ [InsuranceService] Contrat mis à jour';      debugPrint('❌ [InsuranceService] Erreur mise à jour contrat: $e';  /// 🔄 Changer le statut d';      debugPrint('🔍 [InsuranceService] Changement statut contrat: $contractId -> $isActive';        'isActive';      debugPrint('✅ [InsuranceService] Statut contrat mis à jour';      debugPrint('❌ [InsuranceService] Erreur changement statut: $e';      debugPrint('🔍 [InsuranceService] Suppression contrat: $contractId';      // Récupérer le contrat pour obtenir l';        debugPrint('✅ [InsuranceService] Contrat et véhicule supprimés';      debugPrint('❌ [InsuranceService] Erreur suppression contrat: $e';  /// 📊 Statistiques des contrats d';      debugPrint('🔍 [InsuranceService] Statistiques agent: $agentId';          .where('agentId';        'total';        'actifs';        'inactifs';        'expires';        'expirentBientot';      debugPrint('✅ [InsuranceService] Statistiques calculées: $stats';      debugPrint('❌ [InsuranceService] Erreur calcul statistiques: $e';      debugPrint('🔍 [InsuranceService] Recherche avancée contrats';        query = query.where('numeroContrat';        query = query.where('compagnieAssurance';        query = query.where('isActive';        query = query.where('agentId';      debugPrint('✅ [InsuranceService] ${contracts.length} contrats trouvés';      debugPrint('❌ [InsuranceService] Erreur recherche avancée: $e';