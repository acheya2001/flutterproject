import 'package:cloud_firestore/cloud_firestore.dart';import '../models/contrat_assurance_model.dart';import '../models/vehicule_assure_model.dart';/// üìã Service pour g√©rer les contrats d';  /// üìù Cr√©er un nouveau contrat d';          .collection('compagnies_assurance';          .collection('contrats';          .collection('vehicules_assures';            'contractId';            'compagnieId';            'agenceId';            'agentId';            'dateModification';      // Mettre √† jour les statistiques de l';      await _updateAgencyStats(compagnieId, agenceId, 'nouveaux_contrats';      // Mettre √† jour les statistiques de l';      await _updateAgentStats(agentId, 'contrats_crees';      throw Exception('Erreur lors de la cr√©ation du contrat: $e';      Query query = _firestore.collectionGroup('contrats';          .where('numeroContrat';        query = query.where('compagnieId';      throw Exception('Erreur lors de la recherche du contrat: $e';  /// üöó Obtenir les v√©hicules d';          .collection('vehicules_assures';          .where('conducteurId';          .where('isActive';              .collectionGroup('contrats';          'vehicule';          'contrat';          'hasValidContract';      throw Exception('Erreur lors de la r√©cup√©ration des v√©hicules: $e';  /// ‚úÖ Valider un contrat d';  /// üìä Obtenir les statistiques des contrats d';          .collection('compagnies_assurance';          .collection('contrats';          case 'Actif';          case 'Expir√©';          case 'Bient√¥t expir√©';        'totalContrats';        'contratsActifs';        'contratsExpires';        'contratsBientotExpires';        'chiffreAffaires';        'tauxRenouvellement';      throw Exception('Erreur lors du calcul des statistiques: $e';  /// üìà Mettre √† jour les statistiques d';          .collection('compagnies_assurance';          .collection('agences';            'statistiques.$field';            'dateModification';  /// üìà Mettre √† jour les statistiques d';          .collection('agents_assurance';            'statistiques.$field';            'dateModification';      // Cr√©er un nouveau contrat bas√© sur l';          .collection('compagnies_assurance';          .collection('contrats';        throw Exception('Contrat introuvable';      // D√©sactiver l';        'isActive';        'dateModification';        id: '';        numeroContrat: '${ancienContrat.numeroContrat}_R${DateTime.now().year}';          .collection('compagnies_assurance';          .collection('contrats';          .collection('vehicules_assures';            'contractId';            'dateModification';      throw Exception('Erreur lors du renouvellement: $e';