import 'package:flutter/foundation.dart';import 'package:cloud_firestore/cloud_firestore.dart';import 'package:cloud_functions/cloud_functions.dart';/// 📧 Service d';  static final FirebaseFunctions _functions = FirebaseFunctions.instanceFor(region: ';  }';      debugPrint('[SIMPLE_EMAIL] 📧 Envoi email creation compte a: 'userEmail';      // 1. Essayer d';        debugPrint('[SIMPLE_EMAIL] ✅ Email envoye via Cloud Function';        await _logEmailSuccess(userEmail, ';      if (gmailResult';        debugPrint('[SIMPLE_EMAIL] ✅ Email envoye via Gmail direct';        await _logEmailSuccess(userEmail, ';      ';      debugPrint(';    } catch (e';      debugPrint(';      await _logEmailError(userEmail, e.toString()';  /// 🔧 Essayer d';      debugPrint([SIMPLE_EMAIL] 🔄 Tentative Cloud Function (region: europe-west1')...';      debugPrint('[SIMPLE_EMAIL] 📧 Destinataire: 'userEmail';      debugPrint('[SIMPLE_EMAIL] 👤 Utilisateur: 'userName';      debugPrint('[SIMPLE_EMAIL] 🏷️ Rôle: 'role';      final callable = _functions.httpsCallable(';      ';      debugPrint('[SIMPLE_EMAIL] 📤 Appel de la Cloud Function...';        'to';        'subject': 'Bienvenue sur Constat Tunisie - Votre compte a ete cree';        'html';        'text': 'Votre compte a ete cree. Mot de passe temporaire: 'temporaryPassword';        'userName';        'temporaryPassword';        'role';        ';      }';      debugPrint('[SIMPLE_EMAIL] ✅ Reponse Cloud Function: '{result.data}';      final success = result.data[';      if (success';        debugPrint('[SIMPLE_EMAIL] 🎉 Email envoye avec succes via Cloud Function !';        debugPrint(';    } catch (e';      debugPrint('[SIMPLE_EMAIL] ❌ Cloud Function echouee:  + e.toString()';      debugPrint('[SIMPLE_EMAIL] 🔍 Type d\'erreur: '{e.runtimeType}';      // Analyser le type d';      if (e.toString().contains('not-found)';        debugPrint('[SIMPLE_EMAIL] 💡 La Cloud Function "sendEmail" n\'existe pas ou n\';      } else if (e.toString(').contains('unauthenticated)';        debugPrint('[SIMPLE_EMAIL] 💡 Probleme d\';      } else if (e.toString(').contains('permission-denied)';        debugPrint('[SIMPLE_EMAIL] 💡 Permissions insuffisantes pour la Cloud Function';  /// 📧 Essayer d';      // Cette methode utiliserait l';      // Pour l'instant, on simule juste l';      debugPrint('[SIMPLE_EMAIL] 🔄 Tentative Gmail direct...';      // TODO: Implementer l';      debugPrint(';  }';      await _firestore.collection('pending_emails';        'type': 'account_created';        'to';        'userName';        'temporaryPassword';        'role';        'companyName';        'status': 'pending_manual';        'createdAt: FieldValue.serverTimestamp(';        'priority': 'high';        'attempts';        ';    } catch (e';      debugPrint('[SIMPLE_EMAIL] ❌ Erreur sauvegarde:  + e.toString()';  /// 📝 Logger le succes d';      await _firestore.collection('email_logs';        'email';        'status': 'sent';        'method';        ';    } catch (e';      debugPrint('[SIMPLE_EMAIL] ❌ Erreur log succes:  + e.toString()';  /// 📝 Logger l';  static Future<void> _logEmailError(String email, String error';      await _firestore.collection('email_logs';        'email';        'status': 'failed';        'error';        ';    } catch (e';      debugPrint('[SIMPLE_EMAIL] ❌ Erreur log erreur:  + e.toString()';  /// 🎨 Generer le HTML de l';    return ';            <p>Votre compte <strong>"role</strong> a ete cree avec succes'{companyName != null ? ' pour 'companyName' : ';                <div class="password">';    ';  /// 📊 Obtenir les statistiques d';  static Future<Map<String, dynamic>> getEmailStats(';          .collection('email_logs';          .orderBy(';          .get(';          .collection('pending_emails';          .where('status', isEqualTo: ';          .get(';        'total_attempts';        'successful_sends: logsQuery.docs.where((doc) => doc.data(')['status'] == 'sent';        'failed_sends: logsQuery.docs.where((doc) => doc.data(')['status'] == 'failed';        'pending_manual';        ';          final timestamp = doc.data(')[';    } catch (e';      debugPrint('[SIMPLE_EMAIL] ❌ Erreur stats: ';