import 'package:cloud_firestore/cloud_firestore.dart';import 'package:flutter/foundation.dart';import '../models/compagnie_assurance.dart';import '../models/agence_assurance.dart';/// üöÄ Service d';  static const String _collection = 'compagnies_assurance';  static const String _agencesCollection = 'agences';  /// üè¢ Compagnies d';      'nom': 'STAR Assurances';      'code': 'STAR';      'adresseSiege': '47 Avenue Habib Bourguiba';      'ville': 'Tunis';      'gouvernorat': 'Tunis';      'email': 'contact@star.com.tn';      'telephone': '+216 71 340 411';      'siteWeb': 'https://www.star.com.tn';      'isActive';      'nom': 'Maghrebia Assurances';      'code': 'MAGHREBIA';      'adresseSiege': '12 Rue Hedi Nouira';      'ville': 'Tunis';      'gouvernorat': 'Tunis';      'email': 'info@maghrebia.com.tn';      'telephone': '+216 71 783 200';      'siteWeb': 'https://www.maghrebia.com.tn';      'isActive';      'nom': 'Assurances Salim';      'code': 'SALIM';      'adresseSiege': '15 Avenue Mohamed V';      'ville': 'Tunis';      'gouvernorat': 'Tunis';      'email': 'contact@salim.com.tn';      'telephone': '+216 71 254 300';      'siteWeb': 'https://www.salim.com.tn';      'isActive';      'nom': 'Comar Assurances';      'code': 'COMAR';      'adresseSiege': '103 Avenue de la Liberte';      'ville': 'Tunis';      'gouvernorat': 'Tunis';      'email': 'info@comar.com.tn';      'telephone': '+216 71 891 200';      'siteWeb': 'https://www.comar.com.tn';      'isActive';      'nom': 'GAT Assurances';      'code': 'GAT';      'adresseSiege': '55 Avenue Habib Bourguiba';      'ville': 'Tunis';      'gouvernorat': 'Tunis';      'email': 'contact@gat.com.tn';      'telephone': '+216 71 354 800';      'siteWeb': 'https://www.gat.com.tn';      'isActive';      'nom': 'Assurances Hayett';      'code': 'HAYETT';      'adresseSiege': '28 Rue de Marseille';      'ville': 'Tunis';      'gouvernorat': 'Tunis';      'email': 'info@hayett.com.tn';      'telephone': '+216 71 245 600';      'siteWeb': 'https://www.hayett.com.tn';      'isActive';      'nom': 'Lloyd Tunisien';      'code': 'LLOYD';      'adresseSiege': '38 Avenue Farhat Hached';      'ville': 'Sousse';      'gouvernorat': 'Sousse';      'email': 'contact@lloyd.com.tn';      'telephone': '+216 73 225 400';      'siteWeb': 'https://www.lloyd.com.tn';      'isActive';      'nom': 'Assurances Multirisques Tunisie';      'code': 'AMT';      'adresseSiege': '22 Rue Ibn Khaldoun';      'ville': 'Sfax';      'gouvernorat': 'Sfax';      'email': 'info@amt.com.tn';      'telephone': '+216 74 298 500';      'siteWeb': 'https://www.amt.com.tn';      'isActive';      'nom': 'Zitouna Takaful';      'code': 'ZITOUNA';      'adresseSiege': 'Boulevard 14 Janvier';      'ville': 'Tunis';      'gouvernorat': 'Tunis';      'email': 'contact@zitouna-takaful.com.tn';      'telephone': '+216 71 967 300';      'siteWeb': 'https://www.zitouna-takaful.com.tn';      'isActive';      'nom': 'Carte Assurances';      'code': 'CARTE';      'adresseSiege': '45 Avenue de Paris';      'ville': 'Tunis';      'gouvernorat': 'Tunis';      'email': 'info@carte.com.tn';      'telephone': '+216 71 332 100';      'siteWeb': 'https://www.carte.com.tn';      'isActive';  Future<void> initializeCompagnies(';      debugPrint('[DataInit] Debut de l\';      if (existingCompagnies.docs.isNotEmpty';        debugPrint('[DataInit] ';        final docRef = _firestore.collection(_collection).doc(';          'dateCreation: Timestamp.now(';          'metadata';            'source': 'initialization';            'version': '1.0';            'createdBy': ';      await batch.commit(';      debugPrint('[DataInit] ';    } catch (e';      debugPrint('[DataInit] Erreur lors de l\';          .collection(_collection';          .where(';    } catch (e';      debugPrint('[DataInit] Erreur getCompagnieByCode:  + e.toString()';  /// üìä Obtenir les statistiques d';          .where((doc) => (doc.data()['isActive] == true';        'totalCompagnies';        'activeCompagnies';        'inactiveCompagnies';        ';    } catch (e';      debugPrint('[DataInit] Erreur getInitializationStats:  + e.toString()';        'totalCompagnies';        'activeCompagnies';        'inactiveCompagnies';        'lastCheck: DateTime.now(';        ';  Future<void> clearAllData(';      debugPrint(';      await batch.commit(';      debugPrint('[DataInit] ';    } catch (e';      debugPrint(';  Future<void> resetData(';      debugPrint(';      await clearAllData(';      // Attendre un peu pour s';      debugPrint(';    } catch (e';      debugPrint('[DataInit] Erreur lors de la reinitialisation:  + e.toString()';  /// ‚úÖ Verifier l';        final code = data[';        if (code == null || code.isEmpty';          issues.add('Document ';        } else if (codes.contains(code)';          issues.add('Code duplique: ';          codes.add(code';        if (data['nom'] == null || (data['nom] as String).isEmpty';          issues.add('Document '{doc.id}: Nom manquant';        if (data['ville'] == null || (data['ville] as String).isEmpty';          warnings.add('Document '{doc.id}: Ville manquante';        'isValid';        'issues';        'warnings';        'totalDocuments';        ';    } catch (e';        'isValid';        'issues': ['Erreur lors de la verification: 'e';        'warnings';        'totalDocuments';        'checkedAt: DateTime.now(';  /// üè¢ Initialiser les agences d';      debugPrint('[DataInit] Debut de l\';      if (existingAgences.docs.isNotEmpty';        debugPrint('[DataInit] ';      if (compagniesSnapshot.docs.isEmpty';        debugPrint('[DataInit] Aucune compagnie trouvee. Initialisation des compagnies d\';        final compagnieData = compagnieDoc.data(';        final compagnieCode = compagnieData['code';        final compagnieNom = compagnieData[';          final docRef = _firestore.collection(_agencesCollection).doc(';            'dateCreation: Timestamp.now(';            'metadata';              'source': 'initialization';              'version': '1.0';              'createdBy': ';      await batch.commit(';      debugPrint('[DataInit] ';    } catch (e';      debugPrint('[DataInit] Erreur lors de l\'initialisation des agences:  + e.toString()';  /// üè¢ Generer les donnees d';        'nom': 'Agence 'compagnieNom Tunis Centre';        'code': ''compagnieCode-TUN-001';        'compagnieId';        'compagnieNom';        'adresse': 'Avenue Habib Bourguiba';        'ville': 'Tunis';        'gouvernorat': 'Tunis';        'telephone': '+216 71 {_generateRandomPhone(')}';        'email': 'tunis@{compagnieCode.toLowerCase(')}.com.tn';        'responsable': 'Ahmed Ben '{compagnieCode}';        'zone': 'Centre Ville';        'isActive';        'nom': 'Agence 'compagnieNom Sfax';        'code': ''compagnieCode-SFX-001';        'compagnieId';        'compagnieNom';        'adresse': 'Avenue Hedi Chaker';        'ville': 'Sfax';        'gouvernorat': 'Sfax';        'telephone': '+216 74 {_generateRandomPhone(')}';        'email': 'sfax@{compagnieCode.toLowerCase(')}.com.tn';        'responsable': 'Fatma Ben '{compagnieCode}';        'zone': 'Centre Sfax';        'isActive';        'nom': 'Agence 'compagnieNom Sousse';        'code': ''compagnieCode-SOU-001';        'compagnieId';        'compagnieNom';        'adresse': 'Boulevard Yahia Ibn Omar';        'ville': 'Sousse';        'gouvernorat': 'Sousse';        'telephone': '+216 73 {_generateRandomPhone(')}';        'email': 'sousse@{compagnieCode.toLowerCase(')}.com.tn';        'responsable': 'Mohamed Ben '{compagnieCode}';        'zone': 'Centre Sousse';        ';    return random.toString(').padLeft(6, ';  Future<void> initializeAllData(';      debugPrint(';      await initializeAgences(';      debugPrint(';    } catch (e';      debugPrint('[DataInit] Erreur lors de l\'initialisation complete: ';