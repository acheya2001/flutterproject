import 'package:flutter/material.dart';import 'package:cloud_firestore/cloud_firestore.dart';import '../../auth/services/universal_auth_service.dart';import '../../../core/models/admin_hierarchy_model.dart';/// üè¢ Interface d';  String _filtreStatut = 'en_attente';            const Text('Demandes d\'Inscription';              const PopupMenuItem(value: 'en_attente', child: Text('En attente';              const PopupMenuItem(value: 'en_cours_traitement', child: Text('En cours';              const PopupMenuItem(value: 'approuvee', child: Text('Approuv√©es';              const PopupMenuItem(value: 'refusee', child: Text('Refus√©es';              const PopupMenuItem(value: 'toutes', child: Text('Toutes';          // Informations de l';              '${widget.admin.prenom[0]}${widget.admin.nom[0]}';                  '${widget.admin.prenom} ${widget.admin.nom}';              'Actif';            child: Text('Erreur: ${snapshot.error}';          // Filtrer selon les permissions de l';          if (_filtreStatut != 'toutes';                  'Aucune demande';                        '${demande.prenom} ${demande.nom}';            _buildInfoRow('Compagnie';            _buildInfoRow('Agence';            _buildInfoRow('Gouvernorat';            _buildInfoRow('Poste';            _buildInfoRow('Num√©ro Agent';            _buildInfoRow('T√©l√©phone';            _buildInfoRow('Date demande';              _buildInfoRow('Trait√© par', 'Admin ${demande.adminTraitantId}';                      'Motif de refus:';            // Boutons d';                      label: const Text('Approuver';                      label: const Text('Refuser';              '$label:';    Query query = _firestore.collection('demandes_inscription';    // Filtrer selon le type d';        query = query.where('compagnie';            .where('compagnie';            .where('agence';        query = query.where('gouvernorat';      await _firestore.collection('demandes_inscription';        'statut': 'en_cours_traitement';        'adminTraitantId';        'dateTraitement';        userType: 'assureur';          'telephone';          'compagnie';          'agence';          'gouvernorat';          'poste';          'numeroAgent';      if (result['success';        await _firestore.collection('demandes_inscription';          'statut': 'approuvee';          'dateApprobation';        // Mettre √† jour les statistiques de l';        await _mettreAJourStatistiquesAdmin('approuvee';              content: Text('‚úÖ Demande approuv√©e: ${demande.prenom} ${demande.nom}';        throw Exception(result['error';      // Remettre le statut en attente en cas d';      await _firestore.collection('demandes_inscription';        'statut': 'en_attente';        'adminTraitantId';        'dateTraitement';            content: Text('‚ùå Erreur: $e';        title: const Text('Refuser la demande';            Text('√ätes-vous s√ªr de vouloir refuser la demande de ${demande.prenom} ${demande.nom} ?';                labelText: 'Motif du refus (optionnel)';            child: const Text('Annuler';            child: const Text('Refuser';        await _firestore.collection('demandes_inscription';          'statut': 'refusee';          'adminTraitantId';          'dateTraitement';          'motifRefus': motif.isNotEmpty ? motif : 'Aucun motif sp√©cifi√©';        await _mettreAJourStatistiquesAdmin('refusee';              content: Text('‚ùå Demande refus√©e';              content: Text('Erreur: $e';      await _firestore.collection('admins_hierarchy';        'statistiques.demandesTraitees';        'statistiques.demandes${action == 'approuvee' ? 'Approuvees' : 'Refusees'}';        'derniereConnexion';      debugPrint('Erreur mise √† jour statistiques: $e';      case 'en_attente';        return 'En attente';      case 'en_cours_traitement';        return 'En cours';      case 'approuvee';        return 'Approuv√©e';      case 'refusee';        return 'Refus√©e';    return '${date.day.toString().padLeft(2, '0')}/${date.month.toString().padLeft(2, '0')}/${date.year}';      case 'en_attente';        return 'Aucune demande en attente dans votre p√©rim√®tre';      case 'approuvee';        return 'Aucune demande approuv√©e';      case 'refusee';        return 'Aucune demande refus√©e';        return 'Aucune demande trouv√©e';