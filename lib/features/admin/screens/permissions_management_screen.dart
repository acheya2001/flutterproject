import 'package:flutter/material.dart';import 'package:flutter_riverpod/flutter_riverpod.dart';import 'package:cloud_firestore/cloud_firestore.dart';import '../../../core/widgets/custom_app_bar.dart';import '../../auth/models/user_model.dart';import '../../auth/services/notification_service.dart';  String _selectedUserType = 'all';  String _searchQuery = '';    'assureur';      Permission('view_contracts', 'Voir les contrats', 'Acc√®s en lecture aux contrats d\'assurance';      Permission('create_contracts', 'Cr√©er des contrats', 'Cr√©er de nouveaux contrats d\'assurance';      Permission('edit_contracts', 'Modifier les contrats', 'Modifier les contrats existants';      Permission('delete_contracts', 'Supprimer les contrats', 'Supprimer des contrats';      Permission('view_claims', 'Voir les sinistres', 'Acc√®s aux d√©clarations de sinistres';      Permission('process_claims', 'Traiter les sinistres', 'Traiter et valider les sinistres';      Permission('view_reports', 'Voir les rapports', 'Acc√®s aux rapports et statistiques';      Permission('manage_clients', 'G√©rer les clients', 'G√©rer le portefeuille clients';    'expert';      Permission('view_expertises', 'Voir les expertises', 'Acc√®s aux dossiers d\'expertise';      Permission('create_expertises', 'Cr√©er des expertises', 'Cr√©er de nouveaux rapports d\'expertise';      Permission('edit_expertises', 'Modifier les expertises', 'Modifier les rapports existants';      Permission('validate_claims', 'Valider les sinistres', 'Valider les d√©clarations de sinistres';      Permission('access_photos', 'Acc√®s aux photos', 'Voir et analyser les photos d\'accidents';      Permission('generate_reports', 'G√©n√©rer des rapports', 'Cr√©er des rapports d\'expertise';      Permission('view_statistics', 'Voir les statistiques', 'Acc√®s aux statistiques d\'expertise';    'admin';      Permission('manage_users', 'G√©rer les utilisateurs', 'Cr√©er, modifier, supprimer des utilisateurs';      Permission('manage_permissions', 'G√©rer les permissions', 'Attribuer et modifier les permissions';      Permission('view_all_data', 'Voir toutes les donn√©es', 'Acc√®s complet √† toutes les donn√©es';      Permission('system_config', 'Configuration syst√®me', 'Modifier la configuration du syst√®me';      Permission('backup_restore', 'Sauvegarde/Restauration', 'G√©rer les sauvegardes du syst√®me';      Permission('audit_logs', 'Journaux d\'audit', 'Voir les logs d\'activit√© du syst√®me';        title: 'Gestion des Permissions';              hintText: 'Rechercher un utilisateur...';          // Filtres par type d';                _buildFilterChip('all', 'Tous';                _buildFilterChip('assureur', 'Assureurs';                _buildFilterChip('expert', 'Experts';                _buildFilterChip('admin', 'Admins';                Text('Erreur: ${snapshot.error}';                  child: const Text('R√©essayer';                  'Aucun utilisateur trouv√©';    final userType = userData['userType'] ?? '';    final nom = userData['nom'] ?? '';    final prenom = userData['prenom'] ?? '';    final email = userData['email'] ?? '';    final permissions = List<String>.from(userData['permissions';    final accountStatus = _getAccountStatusFromString(userData['accountStatus'] ?? 'active';          '$prenom $nom';                  '${permissions.length} permission(s)';                'Permissions';                label: const Text('Modifier';                  const Text('Aucune permission attribu√©e';                  orElse: () => Permission(permId, permId, 'Permission inconnue';          title: Text('Modifier les permissions - $userType';                  'S√©lectionnez les permissions √† attribuer:';              child: const Text('Annuler';              child: const Text('Sauvegarder';  /// üíæ Mettre √† jour les permissions d';          .collection('users';          .update({'permissions';      // Notifier l';        changedBy: 'admin', // TODO: R√©cup√©rer l'ID de l';            content: Text('Permissions mises √† jour avec succ√®s';            content: Text('Erreur lors de la mise √† jour: $e';    Query query = FirebaseFirestore.instance.collection('users';    if (_selectedUserType != 'all';      query = query.where('userType';      final nom = (userData['nom'] ?? '';      final prenom = (userData['prenom'] ?? '';      final email = (userData['email'] ?? '';  /// üé® Couleur par type d';      case 'assureur';      case 'expert';      case 'admin';      case 'conducteur';  /// üîß Ic√¥ne par type d';      case 'assureur';      case 'expert';      case 'admin';      case 'conducteur';        text = 'Actif';        text = 'En attente';        text = 'Suspendu';        text = 'Rejet√©';        text = 'Inconnu';      case 'active';      case 'pending';      case 'suspended';      case 'rejected';