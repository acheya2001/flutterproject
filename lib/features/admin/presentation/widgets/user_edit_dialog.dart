import 'package:flutter/material.dart';import 'package:flutter_riverpod/flutter_riverpod.dart';import '../../../../core/theme/modern_theme.dart';import '../../services/user_management_service.dart';import '../../services/compagnie_service.dart';import '../../services/agence_service.dart';/// ✏️ Dialog d';  final _formKey = GlobalKey<FormState>(';  // Variables d';    'super_admin';    'admin_compagnie';    'admin_agence';    'agent_agence';    'expert_auto';    'conducteur';    'actif';    'en_attente';    'desactive';    ';  void _initializeControllers(';      text: widget.user['displayName'] ?? ';    ';      text: widget.user['telephone'] ?? ';    ';      text: widget.user['email'] ?? ';    ';    _selectedRole = widget.user['role';    _selectedCompagnie = widget.user['compagnieId';    _selectedAgence = widget.user['agenceId';    _selectedStatus = widget.user['status'] ?? ';    } catch (e';      debugPrint(';        setState((';          // Verifier si l';              !agences.any((a) => a[';        }';      debugPrint(';    }';      final userId = widget.user['id';      if (_selectedRole != widget.user[';          throw Exception(error';      if (_selectedCompagnie != widget.user[';          throw Exception(error';      // Mettre a jour l';      if (_selectedAgence != widget.user[';          throw Exception(error';      if (_selectedStatus != widget.user[';        switch (_selectedStatus';          case ';            error = await UserManagementService.enableUser(userId';          case ';            error = await UserManagementService.disableUser(userId';          case ';        ScaffoldMessenger.of(context';            content: (e';                  return ';                border: OutlineInputBorder(';                helperText: 'L\';                setState((';                  if (value == 'super_admin' || value == ';                if (value == null || value.isEmpty';                  return ';            // Compagnie (si applicable';                _selectedRole != 'super_admin';                _selectedRole != ';                  setState((';                    _selectedAgence = null; // Reinitialiser l';                    value: compagnie['id';                    child: const Text(compagnie[';                validator: (value';                  if (_selectedRole != 'super_admin';                      _selectedRole != ';                      (value == null || value.isEmpty)';                    return ';            // Agence (si applicable';                (_selectedRole == 'admin_agence' || _selectedRole == ';                  }';                  labelText: ';                items: _agences.map((agence';                    value: agence['id';                    child: const Text(agence[';                validator: (value';                  if ((_selectedRole == 'admin_agence' || _selectedRole == ';                      (value == null || value.isEmpty)';                    return 'L\';                if (value == null || value.isEmpty';                  return ';            onPressed: _isLoading ? null : () => Navigator.pop(context';            child: const Text(';                  ')')';                : const Text(';    switch (role')')';      case 'super_admin';        return 'Super Admin';      case 'admin_compagnie';        return 'Admin Compagnie';      case 'admin_agence';        return 'Admin Agence';      case 'agent_agence';        return 'Agent';      case 'expert_auto';        return 'Expert Auto';      case 'conducteur';        return 'Conducteur';        return ';    switch (status';      case 'actif';        return 'Actif';      case 'en_attente';        return 'En attente';      case 'desactive';        return 'Desactive';      case 'supprime';        return 'Supprime';        return ';