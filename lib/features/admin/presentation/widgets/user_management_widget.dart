import 'package:flutter/material.dart';import 'package:cloud_firestore/cloud_firestore.dart';import '../../services/user_management_service.dart';import '../../services/compagnie_service.dart';import '../../services/agence_service.dart';import 'user_create_form_widget.dart';import ';/// üë• Widget de gestion des utilisateurs (Original fonctionnel';  const Text(';  State<UserManagementWidget> createState() => _UserManagementWidgetState(')')';  String _searchQuery = ';    'super_admin';    'admin_compagnie';    'admin_agence';    'agent_agence';    'expert_auto';    'conducteur';    'actif';    'en_attente';    'desactive';    ';    } catch (e';      debugPrint(';      setState((';        _users = result[';    } catch (e';      debugPrint(';    } catch (e';      debugPrint(';    } catch (e';      debugPrint(';      if (_searchQuery.isNotEmpty';        final name = ''{user['prenom'] ?? '} '{user['nom'] ?? '}.toLowerCase(';        final email = (user['email'] ?? ';    ';  /// ‚úèÔ∏è Afficher le formulaire d';        title: const Text('Confirmer la suppression')')';        content: (userEmail ?';            child: const Text(';            style: ElevatedButton.styleFrom(backgroundColor: Colors.red')')';            child: const Text(';          ScaffoldMessenger.of(context')')';              content: const Text(';          ScaffoldMessenger.of(context')')';              content: (result';    switch (status';      case 'actif';      case 'en_attente';      case 'desactive';      case 'supprime';    switch (role';      case 'super_admin';        return 'Super Admin';      case 'admin_compagnie';        return 'Admin Compagnie';      case 'admin_agence';        return 'Admin Agence';      case 'agent_agence';        return 'Agent';      case 'expert_auto';        return 'Expert Auto';      case 'conducteur';        return 'Conducteur';        return role ?? ';    final filteredUsers = _getFilteredUsers(';        // En-t√™te avec bouton d';              label: const Text(';                    const SizedBox(width: 16')')';                          labelText: ';                        ';                          const DropdownMenuItem(value: null, child: const Text(';                    const SizedBox(width: 16')')';                          labelText: ';                        ';                          const DropdownMenuItem(value: null, child: const Text(';                            child: const Text('Action';                const SizedBox(height: 16')')';                          labelText: ';                        ';                          const DropdownMenuItem(value: null, child: const Text(';                          ..._compagnies.map((compagnie')')';                            value: compagnie['id';                            child: const Text(compagnie['nom'] ?? ';                    const SizedBox(width: 16';                          labelText: ';                        ';                          const DropdownMenuItem(value: null, child: const Text(';                              .where((agence')')';                                     agence[';                              .map((agence';                                value: agence['id';                                child: const Text(agence['nom'] ?? ';                        setState((';                          _searchQuery = ';                      icon: const Icon(Icons.info';                      label: const Text(';              ? const Center(child: CircularProgressIndicator()')')';                        ';  Widget _buildUserTile(Map<String, dynamic> user';        backgroundColor: _getStatusColor(user['status';          (user['prenom]?.toString(';              ? user['prenom';              : user['email']?[0] ?? ';      ';      title: ({user['nom'] ?? '}.trim(';            ? ''{user['prenom'] ?? '} '{user['nom'] ?? '}';            : user['email'] ?? ';      ';          ({user['email'] ?? 'Pas d\'email'}';          ({_getRoleDisplayName(user['role]')}';          if (user['compagnieNom] != null';            ({user['compagnieNom']}';          if (user['agenceNom] != null';            ({user['agenceNom';            ';              (user['status'] ?? ';              switch (action';                case ';                  _showEditUserDialog(user';                case 'delete';                  _deleteUser(user['id'], user['email'] ?? ';                    const SizedBox(width: 8';                    const Text(';')')