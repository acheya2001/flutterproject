import 'package:flutter/material.dart';import 'package:fl_chart/fl_chart.dart';import 'package:constat_tunisie/features/admin/services/system_stats_service.dart';import 'package:constat_tunisie/features/admin/services/dashboard_filter_service.dart';import ';  State<BiDashboardScreen> createState() => _BiDashboardScreenState(';  String _selectedPeriod = 'Ce mois';  String _selectedRole = 'Tous';  String _selectedStatus = 'Tous';  String _selectedCompany = ';      setState((';        // Generer les badges d';          stats: _globalStats['activity';          securityStats: _globalStats[';      setState((';        _error = 'Erreur lors du chargement des donnees: ';              ';              tooltip: ';      child: const Text('Action';    ';  /// ‚ùå √âtat d';                label: const Text(';  Widget _buildModernHeader(')')';    final userStats = _globalStats['users';    final lastUpdated = _globalStats[';          const SizedBox(height: 24';                  'Total';                  ''{userStats['total';              const SizedBox(width: 16';                  'Actifs';                  ''{userStats['active';                ({_formatDateTime(lastUpdated')}';                label: const Text(';          const SizedBox(height: 16')')';                  ';                const SizedBox(width: 12';                  ';                const SizedBox(width: 12';                  ';    ';  /// üìä Statistique dans l';      return '${dateTime.day}/${dateTime.month}/${dateTime.year} a "{dateTime.hour}:{dateTime.minute.toString(').padLeft(2, '0')}';      return ';  void _extractAvailableCompanies(';    _availableCompanies = ['STAR Assurance', 'GAT Assurance', ';            children: _alertBadges.map((badge';              final level = badge[';                ';                    const Icon(badge[';                      ';                      child: ({badge['count';  Widget _buildModernKpis(';    final userStats = _globalStats['users';    final activityStats = _globalStats['activity';    final companyStats = _globalStats['companies';        childAspectRatio: 1.5, // Augmente pour plus d';            'Utilisateurs Actifs';            ''{userStats['active';            const Color(0xFF10B981';            subtitle: 'Sur '{userStats['total';          ';            'Compagnies';            ''{companyStats['totalCompanies';            const Color(0xFF3B82F6';            subtitle: ''{companyStats['totalAgencies';          ';            'Actions 24h';            ''{activityStats['auditLogs24h';            const Color(0xFF8B5CF6';            subtitle: 'Logs d\';          ';            'Emails';            ''{activityStats['emailsSent24h';            const Color(0xFFF59E0B';            subtitle: ''{activityStats['emailSuccessRate';  Widget _buildChartsGrid(';    final userStats = _globalStats['users';    final roleStats = userStats['byRole';    final statusStats = userStats['byStatus';    final activityStats = _globalStats['activity';    final actionStats = activityStats['actionStats';    final companyStats = _globalStats[';          const SizedBox(height: 16';            title: 'Repartition par R√¥le';            subtitle: ';          const SizedBox(height: 16';            title: 'Statuts des Comptes';            subtitle: ';          const SizedBox(height: 16';            title: '√âvolution des Inscriptions';            subtitle: Nouveaux utilisateurs (30 derniers jours')';            title: 'Actions Administratives';            subtitle: ';    if (roleStats.isEmpty';          ';        value: (entry.value as num).toDouble(';        title: '';    if (statusStats.isEmpty';          ';      switch (entry.key.toLowerCase()';        case ';          color = const Color(0xFF10B981';        case ';          color = const Color(0xFF6B7280';        case ';                  ';                 const Text(';    if (_growthData.isEmpty')')';          ';    final spots = _growthData.asMap().entries.map((entry';      final value = (data[';                  final data = _growthData[value.toInt(';                  final date = data['date'] as String? ?? ';                      final dateTime = DateTime.parse(date';                      return ({dateTime.month}';                 const Text(';    if (actionStats.isEmpty')')';          ';                  final action = topActions[value.toInt(';                  final displayName = action.replaceAll('_', ';                  return (1')}...';                 const Text(';          const SizedBox(height: 20')')';                  'Compagnies';                  ''{companyStats['totalCompanies';              ';                  'Agences';                  ''{companyStats['totalAgencies';              ';                  'Moyenne';                  ''{companyStats['averageAgenciesPerCompany';      builder: (context';        ';      builder: (context';        ';      builder: (context';        ';        ScaffoldMessenger.of(context';